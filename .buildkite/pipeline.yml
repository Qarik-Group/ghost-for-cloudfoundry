env:
  DEPLOY_BRANCH: production
steps:
  - command: "echo --- ERROR please configure pipeline to only run on $DEPLOY_BRANCH branch; exit 1"
    label: ":git:"
    if: build.branch != '$DEPLOY_BRANCH'
  - label: ":cloudfoundry: deploy"
    if: build.branch == '$DEPLOY_BRANCH'
    agents:
      cf-cli: true
    concurrency: 1
    concurrency_group: "cf-push"
    plugins:
      starkandwayne/cloudfoundry-deploy#v0.6.1:
        api: https://api.run.pivotal.io
        username: drnic@starkandwayne.com
        organization: starkandwayne
        appname: ghost
        space: blog-staging
        manifest_path: manifest.yml
